"use strict";navigator.serviceWorker&&navigator.serviceWorker.register("/cube-timer/sw.js",{scope:"/cube-timer/"});let counter;let timerStartTime;let runStopwatch;let timerState="stopped";const displaytimes=[];let tempallidx;let allthistime;let removed=gotem("removed",[],sessionStorage);let sesremoved=gotem("sesremoved",[],sessionStorage);let keydown=false;let onstart=false;let timeoutStartTime;let runTimeout;let inspectStartTime;let runInspect;const countdown=[15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,"+2","+2","DNF"];let dnf=false;let plustwo=false;const eightSecSound=document.getElementById("eightSecSound");const twelveSecSound=document.getElementById("twelveSecSound");let played8=false;let played12=false;const faces=["F","U","L","R","D","B"];const fewerFaces=["L","R","B","U"];const mods=["",`'`,"2"];const moves3=[];const moves4=[];const moves6=[];const pyrsmoves=[];for(let e=0;e<faces.length*mods.length;e++){moves3.push(faces[Math.trunc(e/3)]+mods[e%3]);moves4.push(faces[Math.trunc(e/3)]+"w"+mods[e%3]);moves6.push("3"+faces[Math.trunc(e/3)]+"w"+mods[e%3])}for(let e=0;e<fewerFaces.length*2;e++){pyrsmoves.push(fewerFaces[Math.trunc(e/2)]+mods[e%2])}const allmoves4=moves3.concat(moves4);const allmoves6=moves6.concat(allmoves4);const pyrpmoves=["l","r","b","u"];const clocksl4=["UL","DL","DR","UR"];const clocksf4=["ALL","L","D","R","U"];const clocks=clocksf4.concat("y2").concat(clocksf4).concat(clocksl4);const tscramble=[];let slen;const oppositeSides={R:"L",L:"R",U:"D",D:"U",F:"B",B:"F"};const scramblers={"2x2":()=>{slen=10;scrambleNxN(moves3)},"3x3":()=>{slen=20;scrambleNxN(moves3)},"4x4":()=>{slen=45;scrambleNxN(allmoves4)},"5x5":()=>{slen=60;scrambleNxN(allmoves4)},"6x6":()=>{slen=70;scrambleNxN(allmoves6)},"7x7":()=>{slen=65;scrambleNxN(allmoves6)},Megaminx:()=>{slen=77;scrambleMegaminx()},Pyraminx:()=>{slen=10;scramblePyraminx()},Skewb:()=>{slen=10;scrambleFourSides()},"Square-1":()=>{slen=15;scrambleSquan()},Clock:()=>{slen=0;scrambleClock()}};let popup=false;let closing=false;let findSession;const scrambletxt=document.getElementById("scrambletxt");const scramblediv=document.getElementById("scramblediv");const scramNum=document.getElementById("scramNum");const scramPlur=document.getElementById("scramPlur");const multiScram=document.getElementById("multiScram");const cubeButton=document.getElementById("cubeButton");const cubeDrop=document.getElementById("cubeDrop");const cubeselect=document.getElementsByClassName("cubeselect");const inspectSet=document.getElementById("inspectSet");const inspectButton=document.getElementById("inspectButton");const inspectDrop=document.getElementById("inspectDrop");const inspselect=document.getElementsByClassName("inspselect");const delaySet=document.getElementById("delaySet");const delayButton=document.getElementById("delayButton");const delayDrop=document.getElementById("delayDrop");const delaytime=document.getElementsByClassName("delaytime");const ttsize=document.getElementById("ttsize");const timebody=document.getElementById("timebody");const outicon=document.getElementById("outicon");const timeTableShadow=document.getElementById("timeTableShadow");const time=document.getElementById("time");const insptime=document.getElementById("insptime");const timealert=document.getElementById("timealert");const onlytime=document.getElementById("onlytime");const centerpop=document.getElementById("centerpop");const showEditTime=document.getElementById("showEditTime");const timepopup=document.getElementById("timepopup");const timepops=document.getElementById("timepops");const shadow=document.getElementById("shadow");const thetwo=document.getElementById("thetwo");const thednf=document.getElementById("thednf");const comment=document.getElementById("comment");const checkmore=document.getElementById("checkmore");const morepopup=document.getElementById("morepopup");const seescramble=document.getElementById("seescramble");const seedate=document.getElementById("seedate");const seecube=document.getElementById("seecube");const best=document.getElementById("best");const worst=document.getElementById("worst");const BWdiv=document.getElementById("bestworst");const sesslc=document.getElementById("sesslc");const sesdrop=document.getElementById("sesdrop");const sespopup=document.getElementById("sespopup");const sameAlert=document.getElementById("sameAlert");const sameAlertAgain=document.getElementById("sameAlertAgain");const sesname=document.getElementById("sesname");const sescrip=document.getElementById("sescrip");const sesoptpopup=document.getElementById("sesoptpopup");const changesesname=document.getElementById("changesesname");const seesescrip=document.getElementById("seesescrip");const sessionsdiv=document.getElementById("sessions");const undobtn=document.getElementById("undobtn");const timenterpopup=document.getElementById("timenterpopup");const timentertoo=document.getElementById("timentertoo");const cubenter=document.getElementById("cubenter");const scramenter=document.getElementById("scramenter");const datenter=document.getElementById("datenter");const commenter=document.getElementById("commenter");const enterArr=[timentertoo,cubenter,scramenter,datenter,commenter];const infopopup=document.getElementById("infopopup");const undone=document.getElementById("undone");const undotxt=document.getElementById("undotxt");const setpopup=document.getElementById("setpopup");const settingsSettings={announce:document.getElementById("countAnnounce"),delayAndInspect:document.getElementById("showSettings"),showBW:document.getElementById("showBW"),BWperSess:document.getElementById("BWSesAll"),hideWhileTiming:document.getElementById("hideThings"),multiScram:document.getElementById("showMScram")};const popups=document.getElementsByClassName("popup");const rcorners=document.getElementById("rcorners");const scorners=document.getElementById("scorners");const isMobile=typeof window.orientation!=="undefined"||navigator.userAgent.indexOf("IEMobile")!==-1;const alltimes=gotem("all",[]);const moddedTimes=gotem("modded",[]);const sessions=gotem("sessions",[{name:"Session 1",description:"Default session"}]);let session=gotem("currses",sessions[0].name);let lightMode=gotem("lightMode",true);const storeSettings=gotem("settings",{announce:true,delayAndInspect:true,showBW:true,BWperSess:false,hideWhileTiming:true,multiScram:true,timein:false,cornerStyle:"r",morechecked:false,startdelay:300,inspectTime:true,cube:"3x3"});const scrambles=gotem("scrambles",[]);let scrambleNum=gotem("scrambleNum",0);document.addEventListener("click",t=>{closeModal(t);const e=e=>t.target.matches(e);if(t.target.closest("#timebody")&&!closing){timeClicks(t)}else if(e(".inspselect")){storeSettings.inspectTime=!(t.target.textContent==="None");colorIndicator(inspselect,t.target.textContent)}else if(e(".cubeselect")&&storeSettings.cube!==t.target.textContent){storeSettings.cube=t.target.textContent;cubeButton.textContent=storeSettings.cube;scrambles.length=0;scrambleNum=0;scramNum.textContent=1;scramble();colorIndicator(cubeselect,storeSettings.cube)}else if(e(".delaytime")){storeSettings.startdelay=parseFloat(t.target.textContent.slice(0,-1))*1e3;colorIndicator(delaytime,t.target.textContent)}else if(e(".modtime")){if(e("#thetwo")){if(thetwo.classList.contains("disabled")){return}allthistime.time=Math.trunc((allthistime.plustwo?allthistime.time-2:allthistime.time+2)*100)/100;allthistime.plustwo=!allthistime.plustwo}else if(e("#thednf")){if(allthistime.dnf){moddedTimes.find((e,t)=>{if(e.date===allthistime.date){thetwo.classList.remove("disabled");alltimes.splice(tempallidx,0,moddedTimes.splice(t,1)[0]);alltimes[tempallidx].dnf=false}})}else{thetwo.classList.add("disabled");moddedTimes.push(allthistime);allthistime.time=0;allthistime.dnf=true}}else if(e("#thedel")&&confirm("Remove this time?")){removed=[{time:alltimes.splice(tempallidx,1)[0],index:tempallidx}]}draw();closeAll()}else if(e(".sesselect")){session=t.target.textContent;sesslc.textContent=session;draw()}else if(e("#nextScram")){scrambleNum++;if(scrambleNum>scrambles.length-1){scramble()}else{scrambletxt.textContent=scrambles[scrambleNum]}scramNum.textContent=scrambleNum+1}else if(e("#firstScram")&&scrambles.length){scrambleNum=0;scrambletxt.textContent=scrambles[0];scramNum.textContent=1}else if(e("#checkmore")){storeSettings.morechecked=checkmore.checked}else if(e("#newses")){showModal(sespopup);sesname.focus();shadow.style.zIndex=101}else if(e("#sescancel")){sespopup.classList.remove("inlineBlock");shadow.style.zIndex=""}else if(e("#timenter")){showModal(timenterpopup);timentertoo.focus()}else if(e("#settingsIcon")){for(let e in settingsSettings){settingsSettings[e].checked=storeSettings[e]}rcorners.id.charAt(0)===storeSettings.cornerStyle?rcorners.checked=true:scorners.checked=true;showModal(setpopup)}else if(e("#deleteallses")&&confirm("Delete all sessions?")){saveAllTimes();sesremoved=sessions;sessions.length=0;sessions.push({name:"Session 1",description:"Default session"});session="Session 1";sesslc.textContent=session;closeNdraw()}else if(e("#deleteses")&&confirm("Delete this session?")){saveCurrentSession();sessions.find((e,s)=>{if(e.name===session){sesremoved.length=0;sesremoved.push(sessions.splice(s,1)[0]);let e=s-1;let t=s+1;if(e!==-1)session=sessions[e].name;else if(e===-1&&sessions[t]!=null)session=sessions[t].name;else{sessions.length=0;alltimes.length=0;sessions.push({name:"Session 1",description:"Default session"});session="Session 1"}}});sesslc.textContent=session;closeNdraw()}else if(e("#clearallses")&&confirm("Do you want to clear all times?")){saveAllTimes();closeNdraw()}else if(e("#clearses")&&confirm("Clear this session?")){saveCurrentSession();closeNdraw()}else if(e("#exportallses")){createCsv(alltimes,"Cube Timer - all times")}else if(e("#exportses")){createCsv(displaytimes,session)}else if(e("#sesopt")){showModal(sesoptpopup);changesesname.value=session;sessions.find(e=>e.name===session&&(findSession=e));seesescrip.value=findSession.description}else if(e("#dothenter")){addNewTime()}else if(e("#inmore")){morepopup.classList[morepopup.matches(".inlineBlock")?"remove":"add"]("inlineBlock");inmore.textContent=inmore.textContent==="[more]"?"[less]":"[more]"}else if(e("#saveses")){if(checkSession(changesesname.value,sameAlertAgain)){for(let e of alltimes){e.session===session&&(e.session=changesesname.value)}sessions.find(e=>{if(e.name===session){e.name=changesesname.value;e.description=seesescrip.value;sesslc.textContent=changesesname.value}});session=changesesname.value}sessions[sessions.indexOf(findSession)].description=seesescrip.value;closeNdraw()}else if(e("#lighticon")){runmode(true)}else if(e("#sescreate")){newSession()}else if(e("#infobtn")){showModal(infopopup)}else if(t.target.closest(".moveTable")||t.target.matches("#timeTableShadow")){timesInOut(true)}else if(multiMatch(t,"#rcorners","#scorners")){changeCorners(t)}else if(multiMatch(t,"#timeclose","#settingsClose")){closeNdraw()}else if(multiMatch(t,"#infoclose","#timentercanc")){closeAll()}const s=dropDown(cubeButton,cubeDrop,t)||dropDown(inspectButton,inspectDrop,t)||dropDown(delayButton,delayDrop,t)||dropDown(sesslc,sesdrop,t);if(!e(".rdropdown")){closeDrops(s)}if(!e("#sesslc")){sesdrop.classList.remove("block")}closing=false},false);document.addEventListener("touchstart",e=>{if(multiMatch(e,"#time","#insptime","#onlytime")){touchdown(e)}},{passive:false,useCapture:false});document.addEventListener("touchend",e=>{if(multiMatch(e,"#time","#insptime","#onlytime")){up()}},{passive:false,useCapture:false});addEventListener("keydown",e=>{if(e.key===" "){down()}else if(e.key==="Escape"){closeAll()}else if(e.key==="z"&&e.ctrlKey&&!popup){undo()}else if(e.key==="Enter"){sespopup.matches(".inlineBlock")&&newSession();timenterpopup.matches(".inlineBlock")&&timentertoo.value!==""&&addNewTime()}else if(timepopup.matches(".inlineBlock")&&!morepopup.matches(".inlineBlock")){e.key==="2"&&(allthistime.plustwo=!allthistime.plustwo);e.key==="d"&&(allthistime.dnf=!allthistime.dnf);closeNdraw()}},false);addEventListener("keyup",e=>{e.key===" "&&up()},false);addEventListener("load",afterLoad,{once:true,useCapture:false});const whichUnload=navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i)?"pagehide":"beforeunload";addEventListener(whichUnload,()=>{localStorage.setItem("all",JSON.stringify(alltimes));localStorage.setItem("settings",JSON.stringify(storeSettings));localStorage.setItem("lightMode",JSON.stringify(lightMode));localStorage.setItem("scrambles",JSON.stringify(scrambles));localStorage.setItem("scrambleNum",JSON.stringify(scrambleNum));localStorage.setItem("currses",JSON.stringify(session));localStorage.setItem("sessions",JSON.stringify(sessions));localStorage.setItem("modded",JSON.stringify(moddedTimes));sessionStorage.setItem("sesremoved",JSON.stringify(sesremoved));sessionStorage.setItem("removed",JSON.stringify(removed))},false);addEventListener("resize",scramOverflowShadow,false);function gotem(e,t,s=localStorage){const n=s.getItem(e);return n==null?t:JSON.parse(n)}function colorIndicator(t,s){for(let e of t){e.classList[e.textContent===s?"add":"remove"]("selected")}}function draw(){if(scrambles.length){scrambletxt.textContent=scrambles[scrambleNum];scramNum.textContent=scrambleNum+1}else{scramble()}displaytimes.length=0;for(let e of alltimes){e.session===session&&displaytimes.push(e)}const s=["number","times","avgofive","avgotwelve"];timebody.innerHTML="";for(let[e,t]of displaytimes.entries()){const n=timebody.insertRow(0);n.className="idAll";const o=[];for(let e=0;e<4;e++){const a=n.insertCell(e);a.className=s[e];o.push(a)}t.number=e+1;o[0].textContent=e+1+(t.comment?"*":null);o[1].textContent=t.dnf?"DNF":t.plustwo?toMinutes(t.time)+"+":toMinutes(t.time);const i=average(e+1,5);const l=average(e+1,12);t.ao5=i;t.ao12=l;o[2].textContent=i;o[3].textContent=l;const c=alltimes.indexOf(t);alltimes[c].ao5=i;alltimes[c].ao12=l}const e=storeSettings.delayAndInspect?document.getElementById("hsSpot"):document.getElementById("popSpot");e.appendChild(inspectSet);e.appendChild(delaySet);BWdiv.classList[storeSettings.showBW?"remove":"add"]("none");bestworst(storeSettings.BWperSess?displaytimes:alltimes);multiScram.classList[storeSettings.multiScram?"remove":"add"]("opZero");sesdrop.innerHTML="";for(let e of sessions){const t=document.createElement("p");t.textContent=e.name;t.classList.add("sesselect");sesdrop.appendChild(t)}sesslc.textContent=session;sesslc.style.minWidth=sesdrop.offsetWidth+"px";document.querySelector("#sesdrop p:nth-child(1)").classList.add("top");document.querySelector("#sesdrop p:last-child").classList.add("bottom")}function afterLoad(){setTimeout(()=>{scramOverflowShadow();timesInOut(false)},10);colorIndicator(inspselect,storeSettings.inspectTime?"15s (WCA)":"None");checkmore.checked=storeSettings.morechecked;storeSettings.morechecked&&(inmore.textContent="[less]");colorIndicator(delaytime,storeSettings.startdelay/1e3+"s");changeCorners(null,storeSettings.cornerStyle);runmode(false);cubeButton.textContent=storeSettings.cube;colorIndicator(cubeselect,storeSettings.cube);draw();if(isMobile){document.addEventListener("touchstart",()=>{eightSecSound.play();eightSecSound.pause();twelveSecSound.play();twelveSecSound.pause()},{once:true,useCapture:false});undobtn.classList.remove("none");undobtn.addEventListener("click",undo,false)}}function closeNdraw(){closeAll();draw()}function timeClicks(e){if(e.target.parentNode.rowIndex>=0){const t=displaytimes.length-e.target.parentNode.rowIndex+1;tempallidx=alltimes.indexOf(displaytimes[t-1]);allthistime=alltimes[tempallidx];timepops.classList.remove("none");showModal(timepopup);inmore.textContent=storeSettings.morechecked?"[less]":"[more]";storeSettings.morechecked&&morepopup.classList.add("inlineBlock");const s=allthistime.dnf?"DNF":toMinutes(allthistime.time);thednf.classList[allthistime.dnf?"add":"remove"]("selected");thetwo.classList[allthistime.dnf?"add":"remove"]("selected");thetwo.classList[allthistime.plustwo?"add":"remove"]("selected");showEditTime.textContent=`${t} (${s})`;scramPlur.textContent=allthistime.scramble.includes(";")?"Scrambles: ":"Scramble: ";seescramble.textContent=allthistime.scramble;seedate.textContent=allthistime.date;seecube.textContent=allthistime.cube;allthistime.comment&&(comment.value=allthistime.comment)}}function closeModal(e){if(!e.target.closest(".popup")&&popup){if(sespopup.classList.contains("inlineBlock")){sespopup.classList.remove("inlineBlock");shadow.style.zIndex=""}else{closeNdraw();closing=true}}}function bestworst(t){const s=[];for(let e of t){e.time&&s.push(e.time)}const e=Math.max(...s);const n=Math.min(...s);best.textContent=!isNaN(JSON.stringify(n))?toMinutes(n):"-";worst.textContent=!isNaN(JSON.stringify(e))?toMinutes(e):"-"}function showModal(e){centerpop.classList.remove("none");e.classList.add("inlineBlock");shadow.classList.add("initial");popup=true}function addNewTime(){if(timentertoo.value!==""&&checkTime(timentertoo.value)){alltimes.push({time:checkTime(timentertoo.value),cube:cubenter.value,session:session,scramble:scramenter.value,date:datenter.value,comment:commenter.value,dnf:false,plustwo:false});for(let e of enterArr){e.value=null}closeNdraw()}else{alert(`I don't recognize that time.`)}}function checkTime(e){const t=e.split(":");if(e<60){return parseFloat(e)}else if(t.length===2){return parseInt(t[0])*60+parseFloat(t[1])}return false}function multiMatch(t,...s){for(let e of s){if(t.target.matches(e)){return true}}return false}function dropDown(e,t,s){if(s.target===e){t.classList.toggle("block");return e.id}return false}function timePos(e){ttsize.classList[e?"add":"remove"]("none");document.body.style.setProperty("--fill-sometimes",e?"1 / -1":"")}function timesInOut(e){if(storeSettings.timein===e){ttsize.style.zIndex="";timePos(false);sessionsdiv.classList.remove("none");timeTableShadow.style.display="";setTimeout(()=>{ttsize.style.gridRow="";ttsize.classList.remove("transXsixty");sessionsdiv.classList.remove("transXhundred");outicon.classList.add("none");scramOverflowShadow()},10)}else{ttsize.style.gridRow="none";ttsize.classList.add("transXsixty");sessionsdiv.classList.add("transXhundred");outicon.classList.remove("none");timeTableShadow.style.display="none";setTimeout(()=>{timePos(true);sessionsdiv.classList.add("none");scramOverflowShadow();ttsize.style.zIndex="unset"},500)}e&&(storeSettings.timein=!storeSettings.timein)}function scrambleNxN(e){const t=e[Math.trunc(Math.random()*e.length)];const s=tscramble[tscramble.length-1];const n=tscramble[tscramble.length-2];let o;let i;let l;const c=t.slice(0,2);const a=t.charAt(0);if(tscramble.length){l=s.charAt(0);i=s.slice(0,2)}if(tscramble.length>1){o=n.charAt(0)}if(c!==i&&l!==a&&(o!==a||oppositeSides[a]!==l)){tscramble.push(t)}}function scrambleFourSides(){const e=pyrsmoves[Math.trunc(Math.random()*pyrsmoves.length)];if(e.charAt(0)!==tscramble?.[0]?.charAt(0)){tscramble.unshift(e)}}function addFour(t,s=.1,n=true){for(let e=0;e<4;e++){if(Math.random()<.5+s){if(Math.random()<.5||!n){tscramble.unshift(t[e])}else{tscramble.unshift(t[e]+`'`)}}}}function scramblePyraminx(){addFour(pyrpmoves);while(tscramble.length<10){scrambleFourSides()}}function scrambleMegaminx(){for(let e=0;e<slen/11;e++){for(let e=0;e<10;e++){const t=Math.random()<.5?"++":"--";const s=e%2?"D":"R";tscramble.push(s+t)}Math.random()<.5?tscramble.push("U\r\n"):tscramble.push(`U'\r\n`)}}function scrambleSquan(){const e=Math.round(Math.random()*11-5);const t=Math.round(Math.random()*11-5);let s;let n;if(tscramble.length){s=tscramble[tscramble.length-1].charAt(1);n=tscramble[tscramble.length-1].charAt(3)}if((e!==s||t!==n)&&(e!==n||t!==s)&&(e!==0||t!==0)){tscramble.push(`(${e},${t})`)}}function scrambleClock(){addFour(clocksl4,0,false);for(let e of clocks){const t=JSON.stringify(Math.round(Math.random()*11-5));const s=t.length>1?t.charAt(1)+t.charAt(0):t.charAt(0)+"+";e!=="y2"?tscramble.unshift(e+s):tscramble.unshift(e)}}function scramble(){tscramble.length=0;do{scramblers[storeSettings.cube]()}while(tscramble.length<slen);scrambles.push(tscramble.join(" "));scrambletxt.textContent=scrambles[scrambleNum];scramOverflowShadow()}function scramOverflowShadow(){scrambletxt.setAttribute("overflow",scrambletxt.scrollHeight!==scrambletxt.clientHeight)}function average(t,s){let e;let n=[];if(t>s-1){for(let e=1;e<s+1;e++){const i=displaytimes[t-e].time;if(i!==0){n.push(i)}}}n.splice(n.indexOf(Math.max(...n)),1);n.splice(n.indexOf(Math.min(...n)),1);n.length&&(e=n.reduce((e,t)=>t+=e));const o=Math.trunc(e/n.length*100)/100;return isNaN(o)?"":toMinutes(o)}function toMinutes(t){if(t<60){return t.toFixed(2)}else if(t>=60&&t<3600){const s=Math.trunc(t/60);let e=(t-60*s).toFixed(2);e<10&&(e="0"+e);return`${s}:${e}`}return`You're slow`}function inspection(){runInspect=requestAnimationFrame(inspection);const e=countdown[Math.trunc((new Date-inspectStartTime)/1e3)];insptime.textContent=e;if(e===7){timealert.classList.remove("none");timealert.textContent="8s!";if(!played8&&storeSettings.announce){eightSecSound.play();played8=true}}else if(e===3){timealert.textContent="12s!";if(!played12&&storeSettings.announce){twelveSecSound.play();played12=true}}else if(e==="+2"){plustwo=true;timealert.classList.add("none")}else if(e==="DNF"){dnf=true;plustwo=false;cancelAnimationFrame(runTimeout)}else if(e==null){time.textContent="0.00";counter=0;fin()}}function stopwatch(){runStopwatch=requestAnimationFrame(stopwatch);counter=Math.trunc((new Date-timerStartTime)/10)/100;time.textContent=toMinutes(counter).toString().slice(0,-1)}function timeout(){runTimeout=requestAnimationFrame(timeout);if(new Date-timeoutStartTime>=storeSettings.startdelay){timerState="waiting";time.classList.add("green");insptime.classList.remove("orange");insptime.classList.add("green")}}function fin(){timerState="stopped";played8=false;played12=false;keydown=true;cancelAnimationFrame(runStopwatch);cancelAnimationFrame(runInspect);time.className="zOne time";timePos(false);time.textContent=toMinutes(counter);insptime.classList.remove("orange","green");onlytime.classList.remove("initial");timealert.classList.add("none");alltimes.push({number:null,time:counter+(plustwo?2:0),cube:storeSettings.cube,session:session,scramble:scrambles.join(";\r\n"),date:(new Date).toString(),dnf:dnf,plustwo:plustwo});dnf=false;plustwo=false;scrambles.length=0;scrambleNum=0;scramNum.textContent=1;scramble();draw()}function down(){if(!popup&&!dnf){if(!onstart&&timerState!=="started"){if(!storeSettings.inspectTime||timerState==="inspecting"){timeoutStartTime=new Date;runTimeout=requestAnimationFrame(timeout);time.classList.add("red");insptime.classList.add("orange")}else{time.classList.add("green")}onstart=true}else if(timerState==="started"){fin()}}}function up(){time.classList.remove("red","green");insptime.classList.remove("orange");if(!popup&&!dnf){if(timerState!=="started"&&timerState!=="waiting"){cancelAnimationFrame(runTimeout);onstart=false}if(!keydown){if(timerState==="waiting"){timerStartTime=new Date;runStopwatch=requestAnimationFrame(stopwatch);storeSettings.hideWhileTiming&&onlytime.classList.add("initial");timePos(true);insptime.classList.add("none");time.classList.remove("none");time.classList.add("zfour");timealert.classList.add("none");cancelAnimationFrame(runInspect);cancelAnimationFrame(runTimeout);timerState="started"}else if(storeSettings.inspectTime&&timerState!=="inspecting"){timePos(true);timerState="inspecting";time.classList.add("none");insptime.classList.remove("none");storeSettings.hideWhileTiming&&onlytime.classList.add("initial");inspectStartTime=new Date;runInspect=requestAnimationFrame(inspection)}closeDrops();sesdrop.classList.remove("block")}else if(keydown){keydown=false}}}function touchdown(e){e.preventDefault();closeAll();down()}function undo(){let e="Nothing to undo";if(removed.length){const t=removed[0].index;for(let e of removed){alltimes[t]==null?alltimes.push(e.time):alltimes.splice(t,0,e.time)}removed.length=0;sessionStorage.removeItem("removed");e="Undone!"}if(sesremoved.length){for(let e of sesremoved){if(!sessions.includes(e)){sessions.push({name:e.name,description:e.description})}}session=sesremoved[sesremoved.length-1].name;sesremoved.length=0;sessionStorage.removeItem("sesremoved");e="Undone!"}undotxt.textContent=e;showModal(undone);setTimeout(closeAll,400);draw()}function runmode(e){e&&(lightMode=!lightMode);document.documentElement.setAttribute("lmode",lightMode)}function changeCorners(e,t){storeSettings.cornerStyle=e?e.target.id.charAt(0):t;document.body.setAttribute("round",storeSettings.cornerStyle==="r")}function closeAll(){timepopup.matches(".inlineBlock")&&(allthistime.comment=comment.value);for(let e of popups){e.classList.remove("inlineBlock")}timepops.classList.add("none");shadow.classList.remove("initial");shadow.style.zIndex="";if(setpopup.matches(".inlineBlock")){for(let e in settingsSettings){storeSettings[e]=settingsSettings[e].checked}}centerpop.classList.add("none");popup=false}function closeDrops(t){for(let e of document.getElementsByClassName("rdropcontent")){e.parentElement.getElementsByClassName("rdropbtn")[0].id!==t&&e.classList.remove("block")}}function checkSession(t,s){for(let e of sessions){if(t===e.name){s.textContent=`You've already used that name.`;return false}}return true}function newSession(){if(sesname.value!==""&&checkSession(sesname.value,sameAlert)){sessions.push({name:sesname.value,description:sescrip.value});sameAlert.textContent=null;sesname.value=null;sescrip.value=null;session=sessions[sessions.length-1].name;closeNdraw()}}function saveCurrentSession(){const t=[];for(let e of alltimes){e.session===session&&t.push(e)}for(let e of t){const s=alltimes.indexOf(e);removed.push({time:alltimes.splice(s,1)[0],index:s,session:session})}}function saveAllTimes(){for(let[e,t]of alltimes.entries()){removed.push({time:t,index:e})}alltimes.length=0;sessions.length=0;localStorage.removeItem("all");time.textContent="0.00"}function createArray(n){let e=[];let t=[];for(let e in n[0]){const s=e.charAt(0).toUpperCase()+e.slice(1);t.push(s)}e.push(t);for(let s of n){let t=[];for(let e in n[0]){t.push(`"${s[e].toString()}"`)}e.push(t)}return e}function createCsv(e,t){const s=createArray(e);let n="data:text/csv;charset=utf-8,";for(let e of s){n+=e+"\n"}const o=encodeURI(n);const i=document.createElement("a");i.setAttribute("href",o);i.setAttribute("download",t+".csv");document.body.appendChild(i);i.click();i.remove();closeAll()}